(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a63f93ec"],{"5fe2":function(e,t,n){},e2e7:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home poolContent home70"},[n("div",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[e._v(" 升级合约 ")]),n("div",{staticStyle:{background:"#1d1e23",padding:"15px","border-radius":"10px"}},[n("div",[e._v(" 代理合约地址 ")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.proxyAddress,expression:"proxyAddress"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.proxyAddress},on:{input:[function(t){t.target.composing||(e.proxyAddress=t.target.value)},function(t){return e.onGetAdming()}]}}),n("div",[e._v(" 代理管理合约地址 ")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.adminAddress,expression:"adminAddress"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.adminAddress},on:{input:[function(t){t.target.composing||(e.adminAddress=t.target.value)},function(t){return e.onGetAdming()}]}}),n("div",[e._v(" 当前逻辑合约地址:"+e._s(e.implAddress)+" ")]),n("div",[e._v(" 待升级的逻辑合约地址:"+e._s(e.pendingUpgrade?e.pendingUpgrade.impl:"")+" ")]),n("div",[e._v(" 可启动升级时间:"+e._s(e.pendingUpgrade&&Number(e.pendingUpgrade.time)>0?e.formatDate(e.pendingUpgrade.time):" - -")+" ")]),e._v(" 共管成员: "),e._l(e.DAOMembers,(function(t){return n("div",[e._v(" "+e._s(t)+e._s(e.$web3Obj.currentAddress.toLowerCase()===t.toLowerCase()?"(是当前钱包)":"(非当前钱包)")+" ")])}))],2),n("div",[n("div",{directives:[{name:"show",rawName:"v-show",value:1===e.shows,expression:"shows === 1"}],staticClass:"flex align-center justify-between",staticStyle:{"margin-top":"13px","margin-bottom":"12px"}},[n("div",{staticClass:"title font-bold",staticStyle:{"margin-right":"8px"}},[e._v("逻辑合约地址")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.newImplAddress,expression:"newImplAddress"}],staticStyle:{height:"28px","border-radius":"4px",border:"1px solid #909090",width:"100%"},attrs:{type:"text"},domProps:{value:e.newImplAddress},on:{input:function(t){t.target.composing||(e.newImplAddress=t.target.value)}}})])]),n("div",{staticClass:"flex align-center justify-between my-1",staticStyle:{"flex-wrap":"wrap"}},[n("div",{staticClass:"tab",class:{active:1==e.shows},on:{click:function(t){return e.doneTab(1)}}},[e._v(" 投票升级 ")]),n("div",{staticClass:"tab",class:{active:2==e.shows},on:{click:function(t){return e.doneTab(2)}}},[e._v(" 启动升级 ")])]),n("div",{staticClass:"tab active",staticStyle:{width:"100%","margin-top":"50px"},on:{click:e.send}},[e._v("确认")])])},a=[],s=n("5530"),i=n("1da1"),d=(n("96cf"),n("d399")),o=n("b775"),c=n("a232"),u=(n("99e5"),n("2f62")),p=-1,l={data:function(){return{proxyAddress:null,proxyContract:null,adminAddress:null,adminContract:null,pendingUpgrade:null,shows:1,implAddress:null,newImplAddress:null,DAOMembers:null}},mounted:function(){this.setShowChainIDErro(!1)},destroyed:function(){clearInterval(p),this.setShowChainIDErro(parseInt(this.$web3Obj.chainId)!==parseInt(this.$config.project.network[this.$route.query.network].chainId))},created:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.onGetAdming();case 1:case"end":return t.stop()}}),t)})))()},methods:Object(s["a"])(Object(s["a"])({},Object(u["b"])(["setShowChainIDErro"])),{},{formatDate:function(e){return e*=1e3,Object(c["formatDate2"])(e)},send:function(){switch(this.shows){case 1:this.upgrade();break;case 2:this.activateDelayedUpgrade();break}},doneTab:function(e){this.shows=e},onGetAdming:function(){var e=this;clearInterval(p),p=setTimeout((function(){try{if(null==e.proxyAddress||e.proxyAddress.length<12)return void Object(d["a"])("请输入代理合约地址");if(null==e.adminAddress||e.adminAddress.length<12)return void Object(d["a"])("请输入admin地址");e.proxyContract=new e.$web3Obj.web3.eth.Contract(e.$config.abi.CustomTransparentProxy,e.proxyAddress),e.adminContract=new e.$web3Obj.web3.eth.Contract(e.$config.abi.CustomProxyAdmin,e.adminAddress),e.updateProxyData()}catch(t){e.initData(),Object(d["a"])("当前链不支持此合约")}}),1e3)},initData:function(){this.pendingUpgrade=null,this.implAddress=null},updateProxyData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.initData(),t.next=3,e.adminContract.methods.getPendingUpgrade(e.proxyAddress).call();case 3:return e.pendingUpgrade=t.sent,t.next=6,e.adminContract.methods.getProxyImplementation(e.proxyAddress).call();case 6:return e.implAddress=t.sent,t.next=9,e.adminContract.methods.daoMembers().call();case 9:e.DAOMembers=t.sent;case 10:case"end":return t.stop()}}),t)})))()},upgrade:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(null==e.newImplAddress||e.newImplAddress.length<12)){t.next=3;break}return Object(d["a"])("请输入逻辑合约地址"),t.abrupt("return");case 3:if(n=confirm("确认升级逻辑合约?到"+e.newImplAddress),!n){t.next=8;break}return t.next=7,o["a"].contractSend(e.adminContract.methods.upgrade(e.proxyAddress,e.newImplAddress).send({from:e.$web3Obj.currentAddress}));case 7:e.updateProxyData();case 8:case"end":return t.stop()}}),t)})))()},activateDelayedUpgrade:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.pendingUpgrade.impl&&"0x0000000000000000000000000000000000000000"!==e.pendingUpgrade.impl){t.next=3;break}return Object(d["a"])("投票还未通过"),t.abrupt("return");case 3:return t.next=5,o["a"].contractSend(e.adminContract.methods.activateDelayedUpgrade(e.proxyAddress).send({from:e.$web3Obj.currentAddress}));case 5:e.updateProxyData();case 6:case"end":return t.stop()}}),t)})))()}})},m=l,g=(n("fb28"),n("2877")),v=Object(g["a"])(m,r,a,!1,null,"c6927958",null);t["default"]=v.exports},fb28:function(e,t,n){"use strict";n("5fe2")}}]);